import _ from"./Captcha-CLkH83mj.js";import{_ as V,h as i,x as h,m as u,p,s as c,u as k,c as B,a,b as f,w as m,r as l,o as M,f as g,t as S}from"./index-Cm55Gr8Q.js";const T={name:"MerchantRegister",components:{Captcha:_},data(){return{form:{username:"",password:"",nickname:"",email:"",phone:"",smsCode:""},errorMessage:{username:"",password:"",email:"",phone:"",smsCode:""},isSending:!1,smsButtonText:"发送验证码",smsCountdown:60}},methods:{validateUsername(){this.errorMessage.username=this.form.username?"":"用户名不能为空"},validatePassword(){this.form.password.length<6?this.errorMessage.password="密码长度不能少于6个字符":this.errorMessage.password=""},validateEmail(){const o=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;this.errorMessage.email=o.test(this.form.email)?"":"请输入有效的邮箱地址"},validatePhone(){const o=/^0[0-9]{9}$/;this.errorMessage.phone=o.test(this.form.phone)?"":"请输入有效的澳大利亚手机号"},async sendSmsCode(){if((!this.form.phone||this.errorMessage.phone)&&(this.validatePhone(),this.errorMessage.phone)){i("请填写正确的手机号");return}try{this.isSending=!0,h({message:"发送中...",forbidClick:!0});const o=await u.post("/api/merchant/sendSmsCode",{phone:this.form.phone});o.data.code===200?(p("验证码已发送"),this.startCountdown()):(this.isSending=!1,c(o.data.message||"验证码发送失败"))}catch(o){this.isSending=!1,c("网络错误，请稍后重试"),console.error("发送验证码错误:",o)}},startCountdown(){this.smsCountdown=60,this.smsButtonText=`${this.smsCountdown}s`,this.isSending=!0;const o=setInterval(()=>{this.smsCountdown--,this.smsCountdown<=0?(clearInterval(o),this.smsButtonText="发送验证码",this.isSending=!1):this.smsButtonText=`${this.smsCountdown}s`},1e3)},async handleSubmit(){if(this.validateUsername(),this.validatePassword(),this.validateEmail(),this.validatePhone(),this.errorMessage.username||this.errorMessage.password||this.errorMessage.email||this.errorMessage.phone){i("请检查输入项是否正确");return}try{h({message:"加载中...",forbidClick:!0});const o=await this.$refs.captchaComponent.validateCaptcha();if(!o){this.$refs.captchaComponent.refreshCaptcha(),console.error("验证码验证失败");return}this.form.captcha=o;const e=await u.post("/api/merchant/register",this.form);e.data.code===200?(k().setToken(e.data.data.token),console.log("注册获取到JWT Token: "+e.data.data.token),p("注册成功"),this.$refs.captchaComponent.refreshCaptcha(),this.$router.push("/merchant/home")):(i(e.data.message||"注册失败"),this.$refs.captchaComponent.refreshCaptcha())}catch(o){i("网络错误，请稍后重试"),this.$refs.captchaComponent.refreshCaptcha(),console.error("注册错误:",o)}},goToLogin(){this.$router.push("/merchant/login")}}},x={class:"page"},y={class:"form"},U={class:"button-container"};function P(o,e,C,R,s,t){const v=l("van-nav-bar"),n=l("van-field"),d=l("van-button"),w=l("Captcha"),b=l("van-cell-group");return M(),B("div",x,[a(v,{title:"注册","right-text":"登录",onClickRight:t.goToLogin},null,8,["onClickRight"]),f("div",y,[a(b,{inset:""},{default:m(()=>[a(n,{modelValue:s.form.username,"onUpdate:modelValue":e[0]||(e[0]=r=>s.form.username=r),label:"用户名",placeholder:"请输入用户名",clearable:"",required:"","error-message":s.errorMessage.username,onBlur:t.validateUsername},null,8,["modelValue","error-message","onBlur"]),a(n,{modelValue:s.form.password,"onUpdate:modelValue":e[1]||(e[1]=r=>s.form.password=r),label:"密码",type:"password",placeholder:"请输入密码",clearable:"",required:"","error-message":s.errorMessage.password,onBlur:t.validatePassword},null,8,["modelValue","error-message","onBlur"]),a(n,{modelValue:s.form.nickname,"onUpdate:modelValue":e[2]||(e[2]=r=>s.form.nickname=r),label:"昵称",placeholder:"请输入昵称",clearable:"",required:"",onBlur:o.validateNickname},null,8,["modelValue","onBlur"]),a(n,{modelValue:s.form.email,"onUpdate:modelValue":e[3]||(e[3]=r=>s.form.email=r),label:"邮箱",placeholder:"请输入邮箱",clearable:"",required:"","error-message":s.errorMessage.email,onBlur:t.validateEmail},null,8,["modelValue","error-message","onBlur"]),a(n,{modelValue:s.form.phone,"onUpdate:modelValue":e[4]||(e[4]=r=>s.form.phone=r),label:"手机号",placeholder:"请输入手机号",clearable:"",required:"","error-message":s.errorMessage.phone,onBlur:t.validatePhone},{button:m(()=>[a(d,{size:"small",type:"primary",disabled:s.isSending,onClick:t.sendSmsCode},{default:m(()=>[g(S(s.smsButtonText),1)]),_:1},8,["disabled","onClick"])]),_:1},8,["modelValue","error-message","onBlur"]),a(n,{modelValue:s.form.smsCode,"onUpdate:modelValue":e[5]||(e[5]=r=>s.form.smsCode=r),label:"短信验证码",placeholder:"请输入短信验证码",clearable:"",required:"","error-message":s.errorMessage.smsCode},null,8,["modelValue","error-message"]),a(w,{ref:"captchaComponent"},null,512)]),_:1}),f("div",U,[a(d,{type:"primary",block:"",onClick:t.handleSubmit},{default:m(()=>e[6]||(e[6]=[g(" 注册 ")])),_:1},8,["onClick"])])])])}const N=V(T,[["render",P],["__scopeId","data-v-47574f52"]]);export{N as default};
