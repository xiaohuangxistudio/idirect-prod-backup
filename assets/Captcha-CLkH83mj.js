import{_ as l,c as r,d as n,o as a}from"./index-Cm55Gr8Q.js";const h={name:"CaptchaService",data(){return{captchaService:null,captchaResult:null,turnstileWidgetId:null}},async mounted(){await this.fetchCaptchaService(),this.initCaptcha()},methods:{async fetchCaptchaService(){try{const e=await this.$axios.get("/api/captcha/getConfigV1");this.captchaService=e.data.data,console.log("Captcha service info:",this.captchaService)}catch(e){console.error("Captcha 获取验证码服务失败：",e)}},initCaptcha(){if(!this.captchaService){console.error("验证码服务未初始化");return}this.captchaService.type==="recaptchaV3"?this.initRecaptchaV3():this.captchaService.type==="turnstile"?this.initTurnstile():console.error("未知的验证码服务类型")},initRecaptchaV3(){const e=this.captchaService.siteKey;if(!e){console.error("Google reCAPTCHA SiteKey 未提供");return}const c="recaptcha-script";if(document.getElementById(c))console.log("Google reCAPTCHA 脚本已加载"),this.refreshCaptcha();else{const t=document.createElement("script");t.id=c,t.src=`https://www.google.com/recaptcha/api.js?render=${e}`,t.async=!0,t.defer=!0,t.onload=()=>{console.log("Google reCAPTCHA 脚本加载完成"),this.refreshCaptcha()},t.onerror=()=>{console.error("Google reCAPTCHA 脚本加载失败")},document.head.appendChild(t)}},initTurnstile(){if(!this.captchaService.siteKey){console.error("Cloudflare Turnstile SiteKey 未提供");return}const c="turnstile-script";if(document.getElementById(c))console.log("Cloudflare Turnstile 脚本已加载"),this.renderTurnstile();else{const t=document.createElement("script");t.id=c,t.src="https://challenges.cloudflare.com/turnstile/v0/api.js",t.async=!0,t.defer=!0,t.onload=()=>{console.log("Cloudflare Turnstile 脚本加载完成"),this.renderTurnstile()},t.onerror=()=>{console.error("Cloudflare Turnstile 脚本加载失败")},document.head.appendChild(t)}},async validateRecaptchaV3(){try{const e=await window.grecaptcha.execute(this.captchaService.siteKey,{action:"submit"});this.captchaResult=e,console.error("Google reCAPTCHA 验证成功")}catch(e){console.error("Google reCAPTCHA 验证失败",e)}},renderTurnstile(){this.$refs.turnstileContainer?(this.turnstileWidgetId=window.turnstile.render(this.$refs.turnstileContainer,{sitekey:this.captchaService.siteKey,callback:e=>{this.captchaResult=e,console.log("Cloudflare Turnstile 验证成功 Token:",e)},theme:"auto",size:"normal"}),console.log("Cloudflare Turnstile 已渲染，Widget ID:",this.turnstileWidgetId)):console.error("Cloudflare Turnstile 容器未找到")},refreshCaptcha(){var e,c;((e=this.captchaService)==null?void 0:e.type)==="recaptchaV3"?(console.log("刷新 Google reCAPTCHA"),window.grecaptcha.ready(()=>{window.grecaptcha.execute(this.captchaService.siteKey,{action:"submit"}).then(t=>{this.captchaResult=t,console.log("Google reCAPTCHA 刷新成功",t)})})):((c=this.captchaService)==null?void 0:c.type)==="turnstile"&&this.turnstileWidgetId!==null?(console.log("刷新 Cloudflare Turnstile"),window.turnstile.reset(this.turnstileWidgetId)):console.error("无法刷新验证码：未正确初始化")},async validateCaptcha(){var e,c;return((e=this.captchaService)==null?void 0:e.type)==="recaptchaV3"?{captchaType:this.captchaService.type,captchaResult:this.captchaResult}:((c=this.captchaService)==null?void 0:c.type)==="turnstile"?{captchaType:this.captchaService.type,captchaResult:this.captchaResult}:null}}},p={key:0,ref:"recaptchaContainer"},u={key:1,ref:"turnstileContainer",class:"turnstile-container"};function d(e,c,t,C,i,f){var s,o;return a(),r("div",null,[((s=i.captchaService)==null?void 0:s.type)==="recaptchaV3"?(a(),r("div",p,null,512)):n("",!0),((o=i.captchaService)==null?void 0:o.type)==="turnstile"?(a(),r("div",u,null,512)):n("",!0)])}const g=l(h,[["render",d]]);export{g as default};
