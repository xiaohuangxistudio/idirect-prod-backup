import{_,s as r,m as c,c as I,a as l,b as h,w as i,r as m,o as v,f as V}from"./index-Cm55Gr8Q.js";const w={name:"MerchantAddShop",data(){return{shopInfo:{name:"",address:"",houseNumber:"",phone:"",previewImages:[],submitImages:[]},errorMessage:{phone:""},autocomplete:null}},mounted(){this.$nextTick(()=>{this.initializeAutocomplete()})},methods:{goBack(){this.$router.push("/merchant/my-shop")},initializeAutocomplete(){var o,e;if(!this.autocomplete&&window.google){const t=(e=(o=this.$refs.addressField)==null?void 0:o.$el)==null?void 0:e.querySelector("input");t?(this.autocomplete=new google.maps.places.Autocomplete(t,{componentRestrictions:{country:"au"},fields:["formatted_address","name"],types:["establishment","geocode"]}),this.autocomplete.addListener("place_changed",this.handlePlaceSelect)):console.error("地址输入框未正确挂载")}else window.google||console.error("Google Maps 未加载")},handlePlaceSelect(){const o=this.autocomplete.getPlace();o&&o.formatted_address?this.shopInfo.address=o.formatted_address:r("无法获取有效地址")},validatePhone(){const o=/^0\d{9}$/;this.errorMessage.phone=o.test(this.shopInfo.phone)?"":"请输入有效的澳大利亚手机号"},async onUpload(o){o.status="uploading",o.message="上传中...";try{const e=new FormData;e.append("file",o.file),e.append("refer","MerchantAddShop");const t=await c.post("/api/merchant/uploadFile",e,{headers:{"Content-Type":"multipart/form-data"}});if(t.data.code===200){const{url:u,uri:a}=t.data.data;o.status="done",o.message="上传成功",this.shopInfo.submitImages.push({url:u,uri:a}),r("图片上传成功")}else o.status="failed",o.message="上传失败",r(t.data.message||"图片上传失败")}catch(e){o.status="failed",o.message="上传失败",r(e.message),console.error("Image upload error:",e)}},onDelete(){return console.log("触发删除图片"),this.shopInfo.submitImages.pop(),console.log(this.shopInfo.submitImages),!0},async onSave(){const{name:o,address:e,houseNumber:t,phone:u,submitImages:a}=this.shopInfo;if(this.validatePhone(),!o||!e||!u){r("请填写完整的商店信息");return}if(a.length==0){r("请上传商店Logo");return}const d={name:o,address:e,phone:u,houseNumber:t,images:a.map(s=>s.uri)};try{const s=await c.post("/api/merchant/addShop",d);if(s.data.code===200)r("商店添加成功"),this.goBack();else{const p=s.data.error?`${s.data.message||"编辑商店失败"}: ${s.data.error}`:s.data.message||"编辑商店失败";r(p)}}catch(s){r("网络错误"),console.error("Add shop error:",s)}}}},y={class:"page"},k={class:"tab-content"},x={class:"button-container"};function S(o,e,t,u,a,d){const s=m("van-nav-bar"),p=m("van-field"),f=m("van-uploader"),g=m("van-cell-group"),b=m("van-button");return v(),I("div",y,[l(s,{title:"新增商店","left-text":"返回","left-arrow":"",onClickLeft:d.goBack},null,8,["onClickLeft"]),h("div",k,[l(g,{inset:""},{default:i(()=>[l(p,{modelValue:a.shopInfo.name,"onUpdate:modelValue":e[0]||(e[0]=n=>a.shopInfo.name=n),label:"名称",placeholder:"请输入商店名称",required:"",clearable:""},null,8,["modelValue"]),l(p,{modelValue:a.shopInfo.address,"onUpdate:modelValue":e[1]||(e[1]=n=>a.shopInfo.address=n),label:"地址",placeholder:"请输入商店地址",required:"",clearable:"",ref:"addressField"},null,8,["modelValue"]),l(p,{modelValue:a.shopInfo.houseNumber,"onUpdate:modelValue":e[2]||(e[2]=n=>a.shopInfo.houseNumber=n),label:"门牌号",placeholder:"请输入商店门牌号",clearable:""},null,8,["modelValue"]),l(p,{modelValue:a.shopInfo.phone,"onUpdate:modelValue":e[3]||(e[3]=n=>a.shopInfo.phone=n),label:"电话",placeholder:"请输入商店电话",required:"",clearable:"","error-message":a.errorMessage.phone,onBlur:d.validatePhone},null,8,["modelValue","error-message","onBlur"]),l(p,{label:"Logo",required:""},{input:i(()=>[l(f,{"result-type":"file","after-read":d.onUpload,"before-delete":d.onDelete,name:"file","max-count":"1",accept:"image/*",modelValue:a.shopInfo.previewImages,"onUpdate:modelValue":e[4]||(e[4]=n=>a.shopInfo.previewImages=n)},null,8,["after-read","before-delete","modelValue"])]),_:1})]),_:1}),h("div",x,[l(b,{type:"primary",block:"",round:"",onClick:d.onSave},{default:i(()=>e[5]||(e[5]=[V("保存商店")])),_:1},8,["onClick"])])])])}const A=_(w,[["render",S],["__scopeId","data-v-7171adb6"]]);export{A as default};
