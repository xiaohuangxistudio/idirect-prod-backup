import{_ as V,x as P,m as u,s as i,q as g,c as y,a,b as s,w as r,r as d,o as C,f as c,t as I}from"./index-Cm55Gr8Q.js";const U={name:"MerchantProfile",setup(){return{goBack:()=>history.back()}},data(){return{active:"setting",showLoading:null,showPopup:{nickname:!1,email:!1,phone:!1},userInfo:{nickname:"",email:"",phone:"",username:""},oldNickname:"",newNickname:"",oldEmail:"",newEmail:"",emailVerificationCode:"",emailButtonText:"获取验证码",isEmailButtonDisabled:!1,oldPhone:"",newPhone:""}},mounted(){this.fetchUserInfo()},methods:{handleTabChange(o){console.log("Tab changed to:",o)},async fetchUserInfo(){try{this.showLoading=P({message:"疯狂加载中...",forbidClick:!0,loadingType:"spinner",duration:5e3});const o=await u.get("/api/merchant/getUserInfoByAuthV1");o.data.code===200?(this.userInfo=o.data.data,this.oldNickname=o.data.data.nickname,this.oldEmail=o.data.data.email,this.oldPhone=o.data.data.phone):i("用户信息加载失败")}catch(o){i("网络错误"),console.error("Fetch userInfo error:",o)}finally{this.showLoading&&this.showLoading.close()}},showUsernamePopup(){g({message:"用户名不支持更改"})},showNicknamePopup(){this.showPopup.nickname=!0},async saveNickname(){if(!this.newNickname.trim()){i("新昵称不能为空");return}try{const o=await u.post("/api/merchant/updateUserInfo",{...this.userInfo,nickname:this.newNickname});o.data.code===200?(this.userInfo.nickname=this.newNickname,this.showPopup.nickname=!1,i("昵称修改成功")):i(o.data.message||"修改失败")}catch(o){i("网络错误"),console.error("Update nickname error:",o)}},showEmailPopup(){this.showPopup.email=!0},async getEmailVerificationCode(){this.isEmailButtonDisabled=!0,this.emailButtonText="60秒后重试";let o=60;const e=setInterval(()=>{o--,this.emailButtonText=`${o}秒后重试`,o<=0&&(clearInterval(e),this.isEmailButtonDisabled=!1,this.emailButtonText="获取验证码")},1e3);try{const p=await u.post("/api/merchant/sendEmailVerification",{email:this.newEmail});p.data.code===200?i("验证码发送成功"):i(p.data.message||"发送失败")}catch(p){i("网络错误"),console.error("Send email verification error:",p)}},async saveEmail(){if(!this.emailVerificationCode.trim()){i("验证码不能为空");return}try{const o=await u.post("/api/merchant/verifyAndUpdateEmail",{email:this.newEmail,verificationCode:this.emailVerificationCode});o.data.code===200?(this.userInfo.email=this.newEmail,this.showPopup.email=!1,i("邮箱修改成功")):i(o.data.message||"修改失败")}catch(o){i("网络错误"),console.error("Update email error:",o)}},showPhonePopup(){this.showPopup.phone=!0},async savePhone(){if(!this.newPhone.trim()){i("新手机号不能为空");return}try{const o=await u.post("/api/merchant/updateUserInfo",{...this.userInfo,phone:this.newPhone});o.data.code===200?(this.userInfo.phone=this.newPhone,this.showPopup.phone=!1,i("手机号修改成功")):i(o.data.message||"修改失败")}catch(o){i("网络错误"),console.error("Update phone error:",o)}},async submitForm(){try{const o=await u.post("/api/merchant/updateUserInfo",this.userInfo);o.data.code===200?i("修改成功"):i(o.data.message||"修改失败")}catch(o){i("网络错误"),console.error("Update userInfo error:",o)}}}},E={class:"page"},_={class:"tab-content"},N={class:"popup-window"},B={class:"popup-content"},x={class:"button-container"},T={class:"popup-window"},L={class:"popup-content"},D={class:"button-container"},A={class:"popup-window"},F={class:"popup-content"},S={class:"button-container"};function q(o,e,p,w,n,m){const k=d("van-nav-bar"),b=d("van-notice-bar"),t=d("van-field"),v=d("van-form"),h=d("van-button"),f=d("van-popup");return C(),y("div",E,[a(k,{title:"个人资料","left-text":"返回","left-arrow":"",onClickLeft:w.goBack},null,8,["onClickLeft"]),s("div",_,[a(b,{color:"#1989fa",background:"#ecf9ff","left-icon":"info-o"},{default:r(()=>e[14]||(e[14]=[c(" 点击对应输入框进行修改 ")])),_:1}),a(v,null,{default:r(()=>[a(t,{modelValue:n.userInfo.username,"onUpdate:modelValue":e[0]||(e[0]=l=>n.userInfo.username=l),name:"username",label:"用户名",readonly:"","input-align":"right",onClick:m.showUsernamePopup},null,8,["modelValue","onClick"]),a(t,{modelValue:n.userInfo.nickname,"onUpdate:modelValue":e[1]||(e[1]=l=>n.userInfo.nickname=l),name:"nickname",label:"昵称",placeholder:"请输入昵称","is-link":"",readonly:"",onClick:m.showNicknamePopup,"input-align":"right"},null,8,["modelValue","onClick"]),a(t,{modelValue:n.userInfo.email,"onUpdate:modelValue":e[2]||(e[2]=l=>n.userInfo.email=l),name:"email",label:"邮箱",placeholder:"请输入邮箱","is-link":"",readonly:"",onClick:m.showEmailPopup,"input-align":"right"},null,8,["modelValue","onClick"]),a(t,{modelValue:n.userInfo.phone,"onUpdate:modelValue":e[3]||(e[3]=l=>n.userInfo.phone=l),name:"phone",label:"手机号",placeholder:"请输入手机号","is-link":"",readonly:"",onClick:m.showPhonePopup,"input-align":"right"},null,8,["modelValue","onClick"])]),_:1})]),s("div",N,[a(f,{show:n.showPopup.nickname,"onUpdate:show":e[6]||(e[6]=l=>n.showPopup.nickname=l),position:"bottom",closeable:"",round:""},{default:r(()=>[s("div",B,[e[16]||(e[16]=s("h3",null,"修改昵称",-1)),a(t,{modelValue:n.oldNickname,"onUpdate:modelValue":e[4]||(e[4]=l=>n.oldNickname=l),label:"旧昵称",readonly:"",disabled:"",value:n.userInfo.nickname},null,8,["modelValue","value"]),a(t,{modelValue:n.newNickname,"onUpdate:modelValue":e[5]||(e[5]=l=>n.newNickname=l),label:"新昵称",placeholder:"请输入新昵称",clearable:""},null,8,["modelValue"]),s("div",x,[a(h,{type:"primary",block:"",onClick:m.saveNickname},{default:r(()=>e[15]||(e[15]=[c("保存更改")])),_:1},8,["onClick"])])])]),_:1},8,["show"])]),s("div",T,[a(f,{show:n.showPopup.email,"onUpdate:show":e[10]||(e[10]=l=>n.showPopup.email=l),position:"bottom",closeable:"",round:""},{default:r(()=>[s("div",L,[e[18]||(e[18]=s("h3",null,"修改邮箱",-1)),a(t,{modelValue:n.oldEmail,"onUpdate:modelValue":e[7]||(e[7]=l=>n.oldEmail=l),label:"旧邮箱",readonly:"",disabled:"",value:n.userInfo.email},null,8,["modelValue","value"]),a(t,{modelValue:n.newEmail,"onUpdate:modelValue":e[8]||(e[8]=l=>n.newEmail=l),label:"新邮箱",placeholder:"请输入新邮箱",clearable:""},{button:r(()=>[a(h,{disabled:n.isEmailButtonDisabled,size:"small",type:"primary",block:"",onClick:m.getEmailVerificationCode},{default:r(()=>[c(I(n.emailButtonText),1)]),_:1},8,["disabled","onClick"])]),_:1},8,["modelValue"]),a(t,{modelValue:n.emailVerificationCode,"onUpdate:modelValue":e[9]||(e[9]=l=>n.emailVerificationCode=l),label:"验证码",placeholder:"请输入验证码",clearable:""},null,8,["modelValue"]),s("div",D,[a(h,{type:"primary",block:"",onClick:m.saveEmail},{default:r(()=>e[17]||(e[17]=[c("保存更改")])),_:1},8,["onClick"])])])]),_:1},8,["show"])]),s("div",A,[a(f,{show:n.showPopup.phone,"onUpdate:show":e[13]||(e[13]=l=>n.showPopup.phone=l),position:"bottom",closeable:"",round:""},{default:r(()=>[s("div",F,[e[20]||(e[20]=s("h3",null,"修改手机号",-1)),a(t,{modelValue:n.oldPhone,"onUpdate:modelValue":e[11]||(e[11]=l=>n.oldPhone=l),label:"旧手机号",readonly:"",disabled:"",value:n.userInfo.phone},null,8,["modelValue","value"]),a(t,{modelValue:n.newPhone,"onUpdate:modelValue":e[12]||(e[12]=l=>n.newPhone=l),label:"新手机号",placeholder:"请输入新手机号",clearable:""},null,8,["modelValue"]),s("div",S,[a(h,{type:"primary",block:"",onClick:m.savePhone},{default:r(()=>e[19]||(e[19]=[c("保存更改")])),_:1},8,["onClick"])])])]),_:1},8,["show"])])])}const M=V(U,[["render",q],["__scopeId","data-v-92c686f0"]]);export{M as default};
