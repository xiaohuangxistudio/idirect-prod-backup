import{_ as O,i as V,E as f,g as x,w as r,r as m,o as c,a as o,b as i,f as n,d as D,t as h,c as v}from"./index-Cm55Gr8Q.js";const P={name:"MerchantCreateDeliveryOld",data(){return{form:{merchantName:"",merchantPhone:"",merchantAddress:"",customerName:"",customerPhone:"",customerAddress:"",deliveryTimeOption:"ASAP",deliveryTime:null,merchantRemark:"",customerRemark:"",quoteUniqueId:""},distanceText:"",durationText:"",quoteFee:null,canDelivery:null,canDeliveryReason:"",isQuoteObtained:!1,quoteLoading:!1,submitLoading:!1,rules:{merchantName:[{required:!0,message:"请输入商家名称",trigger:"blur"}],merchantPhone:[{required:!0,message:"请输入商家电话",trigger:"blur"}],merchantAddress:[{required:!0,message:"请输入商家地址",trigger:"blur"}],customerName:[{required:!0,message:"请输入客户名称",trigger:"blur"}],customerPhone:[{required:!0,message:"请输入客户电话",trigger:"blur"}],customerAddress:[{required:!0,message:"请输入客户地址",trigger:"blur"}],deliveryTime:[{validator:this.validateDeliveryTime,message:"请选择期望送达时间",trigger:"change"}]}}},mounted(){this.initAutocomplete()},methods:{resetQuoteStatus(){this.isQuoteObtained=!1},validateDeliveryTime(l,e,d){this.form.deliveryTimeOption==="选择时间"&&!e?d(new Error("请选择送达时间")):d()},initAutocomplete(){const l={location:new google.maps.LatLng(-33.8688,151.2093),radius:5e4},e=this.$refs.merchantAddressInput.$refs.input,d=new google.maps.places.Autocomplete(e,{componentRestrictions:{country:"au"},fields:["formatted_address","name"],types:["establishment","geocode"]});d.setBounds(l),d.addListener("place_changed",()=>{const a=d.getPlace();this.form.merchantAddress=a.formatted_address});const g=this.$refs.customerAddressInput.$refs.input,t=new google.maps.places.Autocomplete(g,{componentRestrictions:{country:"au"},fields:["formatted_address","name"],types:["establishment","geocode"]});t.setBounds(l),t.addListener("place_changed",()=>{const a=t.getPlace();this.form.customerAddress=a.formatted_address})},getCurrentLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(l=>{const{latitude:e,longitude:d}=l.coords;this.getAddressFromCoordinates(e,d)},l=>{console.error("获取位置失败:",l),alert("无法获取当前位置，请检查浏览器位置权限")}):alert("您的浏览器不支持地理位置功能")},getAddressFromCoordinates(l,e){const d=new google.maps.Geocoder,g={lat:l,lng:e};d.geocode({location:g},(t,a)=>{a==="OK"?t[0]?this.form.merchantAddress=t[0].formatted_address:alert("未找到地址"):alert("Geocoder 失败: "+a)})},submitForm(){this.isQuoteObtained&&(this.submitLoading=!0,this.$refs.form.validate(async l=>{if(l)try{const e=await V.post("https://delivery-prod-api.xiaohuangxi.studio/api/DeliveryService/submitDelivery",this.form);if(console.log("Form submitted:",e.data),e.data.code===200){f({message:e.data.msg||"表单提交成功",type:"success",duration:3e3});const d=e.data.data.delivery_id;this.$router.push({name:"MerchantSubmitSuccess",query:{delivery_id:d}})}else f({message:e.data.msg||"提交失败，请稍后再试",type:"error",duration:3e3})}catch(e){f({message:"提交失败"+e,type:"error",duration:3e3})}finally{this.submitLoading=!1}else f({message:"表单参数验证失败",type:"error",duration:3e3}),this.submitLoading=!1}))},resetForm(){this.isQuoteObtained=!1,this.$refs.form.resetFields()},async getQuote(){this.quoteLoading=!0;try{console.log("Calling getQuote with addresses:",this.form.merchantAddress,this.form.customerAddress);const l=await V.post("https://delivery-api.xiaohuangxi.studio/api/Delivery/getDeliveryQuote",{merchantAddress:this.form.merchantAddress,customerAddress:this.form.customerAddress});if(l.data.code===1){const e=l.data.data;console.log("Received quote data:",e),this.distanceText=e.distance_description,this.durationText=e.duration_description,this.quoteFee=e.quoteAmount/100,this.canDelivery=e.canDelivery,this.canDeliveryReason=e.canDeliveryReason,this.form.quoteUniqueId=e.quoteUniqueId,this.isQuoteObtained=!0}else f({message:l.data.msg||"报价获取失败",type:"error",duration:3e3}),this.isQuoteObtained=!1,this.resetQuoteData()}catch(l){console.error("Error:",l),this.resetQuoteData(),f({message:"服务器异常",type:"error",duration:3e3})}finally{this.quoteLoading=!1}},resetQuoteData(){this.distanceText="",this.durationText="",this.quoteFee=null,this.canDelivery=null,this.canDeliveryReason="",this.isQuoteObtained=!1}}},R={style:{width:"100%"}},F={style:{"margin-top":"8px","text-align":"right"}},L={style:{display:"flex",gap:"8px",width:"100%"}},N={key:0},U={key:1},S={key:2},E={key:0};function Y(l,e,d,g,t,a){const k=m("el-header"),b=m("el-divider"),p=m("el-input"),u=m("el-form-item"),y=m("el-button"),A=m("el-radio"),T=m("el-radio-group"),C=m("el-date-picker"),_=m("el-tag"),q=m("el-card"),I=m("el-form"),w=m("el-main"),Q=m("el-container");return c(),x(Q,null,{default:r(()=>[o(k,{height:"60px",class:"navbar"},{default:r(()=>e[10]||(e[10]=[i("div",{class:"navbar-left"},[i("span",{class:"title"},"创建配送订单")],-1)])),_:1}),o(w,{style:{width:"100%",display:"flex","flex-direction":"column","align-items":"center","text-align":"center"}},{default:r(()=>[o(I,{ref:"form",model:t.form,rules:t.rules,"label-width":"null",style:{"max-width":"600px",margin:"auto"}},{default:r(()=>[o(b,{"content-position":"center"},{default:r(()=>e[11]||(e[11]=[n("商家信息")])),_:1}),o(u,{label:"商家名称",prop:"merchantName"},{default:r(()=>[o(p,{modelValue:t.form.merchantName,"onUpdate:modelValue":e[0]||(e[0]=s=>t.form.merchantName=s),placeholder:"请输入商家名称"},null,8,["modelValue"])]),_:1}),o(u,{label:"商家电话",prop:"merchantPhone"},{default:r(()=>[o(p,{modelValue:t.form.merchantPhone,"onUpdate:modelValue":e[1]||(e[1]=s=>t.form.merchantPhone=s),placeholder:"请输入商家电话"},{prepend:r(()=>e[12]||(e[12]=[n("+61")])),_:1},8,["modelValue"])]),_:1}),o(u,{label:"商家地址",prop:"merchantAddress"},{default:r(()=>[i("div",R,[o(p,{modelValue:t.form.merchantAddress,"onUpdate:modelValue":e[2]||(e[2]=s=>t.form.merchantAddress=s),placeholder:"请输入商家地址",ref:"merchantAddressInput",onInput:l.handleAddressInput,onChange:a.resetQuoteStatus,style:{width:"100%"}},null,8,["modelValue","onInput","onChange"])]),i("div",F,[o(y,{type:"primary",onClick:a.getCurrentLocation},{default:r(()=>e[13]||(e[13]=[n(" 获取当前位置 ")])),_:1},8,["onClick"])])]),_:1}),o(u,{label:"商家备注",prop:"merchantRemark"},{default:r(()=>[o(p,{modelValue:t.form.merchantRemark,"onUpdate:modelValue":e[3]||(e[3]=s=>t.form.merchantRemark=s),rows:2,type:"textarea",placeholder:"请输入商家备注"},null,8,["modelValue"])]),_:1}),o(b,{"content-position":"center"},{default:r(()=>e[14]||(e[14]=[n("客户信息")])),_:1}),o(u,{label:"客户名称",prop:"customerName"},{default:r(()=>[o(p,{modelValue:t.form.customerName,"onUpdate:modelValue":e[4]||(e[4]=s=>t.form.customerName=s),placeholder:"请输入客户名称"},null,8,["modelValue"])]),_:1}),o(u,{label:"客户电话",prop:"customerPhone"},{default:r(()=>[o(p,{modelValue:t.form.customerPhone,"onUpdate:modelValue":e[5]||(e[5]=s=>t.form.customerPhone=s),placeholder:"请输入客户电话"},{prepend:r(()=>e[15]||(e[15]=[n("+61")])),_:1},8,["modelValue"])]),_:1}),o(u,{label:"客户地址",prop:"customerAddress"},{default:r(()=>[i("div",L,[o(p,{modelValue:t.form.customerAddress,"onUpdate:modelValue":e[6]||(e[6]=s=>t.form.customerAddress=s),placeholder:"请输入客户地址",ref:"customerAddressInput",onInput:l.handleAddressInput,onChange:a.resetQuoteStatus,style:{flex:"1"}},null,8,["modelValue","onInput","onChange"])])]),_:1}),o(u,{label:"客户备注",prop:"merchantRemark"},{default:r(()=>[o(p,{modelValue:t.form.customerRemark,"onUpdate:modelValue":e[7]||(e[7]=s=>t.form.customerRemark=s),rows:2,type:"textarea",placeholder:"请输入客户备注（例如：房间号或送达打电话或无接触配送等）"},null,8,["modelValue"])]),_:1}),o(u,{label:"预计送达时间",prop:"deliveryTimeOption"},{default:r(()=>[o(T,{modelValue:t.form.deliveryTimeOption,"onUpdate:modelValue":e[8]||(e[8]=s=>t.form.deliveryTimeOption=s)},{default:r(()=>[o(A,{label:"ASAP"},{default:r(()=>e[16]||(e[16]=[n("尽快")])),_:1}),o(A,{label:"SPECIFY_TIME"},{default:r(()=>e[17]||(e[17]=[n("指定时间")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t.form.deliveryTimeOption==="SPECIFY_TIME"?(c(),x(u,{key:0,label:"期望送达时间",prop:"deliveryTime"},{default:r(()=>[o(C,{modelValue:t.form.deliveryTime,"onUpdate:modelValue":e[9]||(e[9]=s=>t.form.deliveryTime=s),type:"datetime",placeholder:"选择日期和时间",disabled:t.form.deliveryTimeOption==="ASAP",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss","picker-options":{disabledDate(s){return s.getTime()<Date.now()},selectableRange:"08:00:00 - 23:00:00"}},null,8,["modelValue","disabled","picker-options"])]),_:1})):D("",!0),o(u,null,{default:r(()=>[o(y,{type:"primary",onClick:a.getQuote,disabled:t.isQuoteObtained,loading:t.quoteLoading},{default:r(()=>e[18]||(e[18]=[n(" 获取报价 ")])),_:1},8,["onClick","disabled","loading"]),o(y,{type:"primary",onClick:a.submitForm,disabled:!t.isQuoteObtained,loading:t.submitLoading},{default:r(()=>e[19]||(e[19]=[n(" 提交 ")])),_:1},8,["onClick","disabled","loading"]),o(y,{onClick:a.resetForm},{default:r(()=>e[20]||(e[20]=[n("重置")])),_:1},8,["onClick"])]),_:1}),o(b,{"content-position":"center"},{default:r(()=>e[21]||(e[21]=[n("报价信息")])),_:1}),o(q,{style:{"max-width":"480px"}},{default:r(()=>[i("p",null,[e[22]||(e[22]=i("strong",null,"配送距离：",-1)),n(" "+h(t.distanceText||"未计算"),1)]),i("p",null,[e[23]||(e[23]=i("strong",null,"配送时间：",-1)),n(" "+h(t.durationText||"未计算"),1)]),i("p",null,[e[24]||(e[24]=i("strong",null,"报价费用：",-1)),n(" "+h(t.quoteFee!==null?"$"+t.quoteFee:"未计算"),1)]),i("p",null,[e[28]||(e[28]=i("strong",null,"配送状态：",-1)),t.canDelivery===!0?(c(),v("span",N,[o(_,{type:"success"},{default:r(()=>e[25]||(e[25]=[n("可以配送")])),_:1})])):t.canDelivery===!1?(c(),v("span",U,[o(_,{type:"danger"},{default:r(()=>e[26]||(e[26]=[n("不可配送")])),_:1})])):(c(),v("span",S,[o(_,{type:"info"},{default:r(()=>e[27]||(e[27]=[n("未知")])),_:1})]))]),!t.canDelivery&&t.canDeliveryReason?(c(),v("p",E,[e[29]||(e[29]=i("strong",null,"原因：",-1)),n(" "+h(t.canDeliveryReason),1)])):D("",!0)]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1})}const B=O(P,[["render",Y],["__scopeId","data-v-586fc0e5"]]);export{B as default};
