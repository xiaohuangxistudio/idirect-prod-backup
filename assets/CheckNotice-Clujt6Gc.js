import{_,m as p,s as i,z as w,c as a,a as r,w as c,r as u,o as l,b as n,F as N,e as b,t as v,f as d,d as y}from"./index-Cm55Gr8Q.js";const k={data(){return{notices:[],forcePopup:!1,forcePopupCount:0,showNoticeContent:!1,currentNotice:{},hasRead:!1}},methods:{async fetchNotices(){try{const o=await p.get("/api/merchant/getForcePopupNotices");o.data.code===200?(this.notices=o.data.data.forcePopupNotices||[],this.forcePopup=this.notices.length>0,this.forcePopupCount=o.data.data.forcePopupCount||0):i("公告加载失败")}catch(o){console.error("Fetch notices error:",o),i("网络错误")}},async viewNotice(o){try{const e=await p.get("/api/merchant/getNoticeDetail",{params:{noticeId:o}});e.data.code===200?(this.currentNotice=e.data.data,this.showNoticeContent=!0,this.hasRead=!1,this.currentNotice.needConfirm===0&&this.removeNoticeFromList(o)):i("公告详情加载失败")}catch(e){console.error("Fetch notice detail error:",e),i("网络错误")}},removeNoticeFromList(o){this.notices=this.notices.filter(e=>e.id!==o),this.forcePopupCount--,this.forcePopupCount<=0&&(this.forcePopup=!1)},showConfirmDialog(){w({title:"确认提交",message:"请问是否确认已经完整阅读当前公告并明白内容？"}).then(()=>{this.confirmNotice(this.currentNotice.id)}).catch(()=>{i("取消提交")})},async confirmNotice(o){try{(await p.post("/api/merchant/confirmNotice",{id:o})).data.code===200?(i("公告已确认"),this.showNoticeContent=!1,this.removeNoticeFromList(o)):i("公告确认失败")}catch(e){console.error("Confirm notice error:",e),i("网络错误")}}},mounted(){this.fetchNotices()}},g={class:"popup-content"},P={class:"notice-title"},x={class:"notice-content"},F=["innerHTML"],V={class:"read-confirmation"},L={class:"submit-section"};function D(o,e,R,T,t,h){const f=u("van-button"),m=u("van-popup"),C=u("van-checkbox");return l(),a("div",null,[r(m,{show:t.forcePopup,"onUpdate:show":e[0]||(e[0]=s=>t.forcePopup=s),position:"center","close-on-click-overlay":!1,"overlay-closeable":!1},{default:c(()=>[n("div",g,[e[4]||(e[4]=n("h2",null,"未读公告列表",-1)),(l(!0),a(N,null,b(t.notices,s=>(l(),a("div",{key:s.id,class:"notice-item"},[n("div",P,v(s.title),1),r(f,{type:"primary",size:"small",onClick:B=>h.viewNotice(s.id)},{default:c(()=>e[3]||(e[3]=[d(" 查看 ")])),_:2},1032,["onClick"])]))),128))])]),_:1},8,["show"]),r(m,{show:t.showNoticeContent,"onUpdate:show":e[2]||(e[2]=s=>t.showNoticeContent=s),position:"bottom",style:{height:"90%"},closeable:!1,"overlay-closeable":!1},{default:c(()=>[n("div",x,[n("h3",null,v(t.currentNotice.title),1),n("div",{innerHTML:t.currentNotice.content,class:"html-content"},null,8,F),t.currentNotice.needConfirm===1?(l(),a(N,{key:0},[n("div",V,[r(C,{modelValue:t.hasRead,"onUpdate:modelValue":e[1]||(e[1]=s=>t.hasRead=s),class:"checkbox"},{default:c(()=>e[5]||(e[5]=[d(" 我已经完整阅读当前公告并明白内容"),n("br",null,null,-1),d("I have read the current notice in full and understand its contents ")])),_:1},8,["modelValue"])]),n("div",L,[r(f,{type:"primary",block:"",class:"submit-button",disabled:!t.hasRead,onClick:h.showConfirmDialog},{default:c(()=>e[6]||(e[6]=[d(" 提交 ")])),_:1},8,["disabled","onClick"])])],64)):y("",!0)])]),_:1},8,["show"])])}const z=_(k,[["render",D],["__scopeId","data-v-6d4d147d"]]);export{z as default};
