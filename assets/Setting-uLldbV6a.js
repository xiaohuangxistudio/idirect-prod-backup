import{_ as b,m as P,s as r,u as T,c as p,a as e,b as n,y as U,t as g,w as l,r as s,o as d,g as B,d as S,f as _}from"./index-Cm55Gr8Q.js";import x from"./CheckNotice-Clujt6Gc.js";import V from"./GetAnnounce-DC0WFN4G.js";const A={name:"MerchantSetting",components:{CheckNotice:x,GetAnnounce:V},data(){return{active:"setting",userInfo:{},loadingUserInfo:!0,deferredPrompt:null,showInstallButton:!1}},mounted(){this.fetchUserInfo(),window.addEventListener("beforeinstallprompt",o=>{o.preventDefault(),this.deferredPrompt=o,this.showInstallButton=!0})},methods:{navigateTo(o){this.$router.push(o)},navigateToMyShop(){this.$router.push("/merchant/my-shop")},navigateToProfile(){this.$router.push("/merchant/profile")},navigateToPWAInstall(){this.$router.push("/merchant/pwa-install")},async fetchUserInfo(){try{console.log(this.loadingUserInfo);const o=await P.get("/api/merchant/getUserInfoByAuthV1");o.data.code===200?(this.userInfo=o.data.data,console.log(this.userInfo)):r("用户信息加载失败")}catch(o){r("网络错误"),console.error("Fetch userInfo error:",o)}finally{this.loadingUserInfo=!1}},triggerInstall(){this.deferredPrompt&&(this.deferredPrompt.prompt(),this.deferredPrompt.userChoice.then(o=>{o.outcome==="accepted"?(r("安装中"),console.log("用户接受了安装")):(r("安装失败"),console.log("用户拒绝了安装")),this.deferredPrompt=null,this.showInstallButton=!1}))},logout(){T().logout(),this.$router.push("/merchant/login"),r("退出成功")}}},N={class:"page"},G={class:"tab-content"},M={key:0,class:"skeleton-container"},D={class:"skeleton-paragraphs"},E={key:1,class:"user-info-container"},R={class:"head-image"},W={class:"user-details"},z={class:"user-name"},F={class:"user-email"},K={class:"user-phone"};function L(o,t,j,q,a,i){const f=s("van-nav-bar"),v=s("GetAnnounce"),k=s("van-skeleton-image"),h=s("van-skeleton-paragraph"),I=s("van-image"),c=s("van-cell"),C=s("van-cell-group"),u=s("van-tabbar-item"),w=s("van-tabbar"),y=s("CheckNotice");return d(),p("div",N,[e(f,{title:"设置","right-text":"退出",onClickRight:i.logout},null,8,["onClickRight"]),n("div",G,[n("div",null,[e(v,{pageKey:"merchantSettingPagePost"})]),n("div",{class:U(["loading-container",{loading:a.loadingUserInfo,loaded:!a.loadingUserInfo}])},[a.loadingUserInfo?(d(),p("div",M,[e(k,{class:"skeleton-image","image-shape":"round"}),n("div",D,[e(h,{"row-width":"80%"}),e(h,{"row-width":"80%"}),e(h,{"row-width":"80%"})])])):(d(),p("div",E,[n("div",R,[e(I,{round:"",fit:"cover",width:"5rem",height:"5rem",src:"https://delivery-api.xiaohuangxi.studio/assets/img/avatar.png"})]),n("div",W,[n("div",z,g(a.userInfo.nickname||"未设置用户名"),1),n("div",F,g(a.userInfo.email||"未设置邮箱"),1),n("div",K,g(a.userInfo.phone||"未设置手机号"),1)])]))],2),e(C,null,{default:l(()=>[e(c,{title:"个人资料",icon:"description-o","is-link":"",onClick:i.navigateToProfile},null,8,["onClick"]),e(c,{title:"店铺管理",icon:"shop-o","is-link":"",onClick:i.navigateToMyShop},null,8,["onClick"]),a.showInstallButton?(d(),B(c,{key:0,title:"快捷安装应用",icon:"records-o","is-link":"",onClick:i.triggerInstall},null,8,["onClick"])):S("",!0),e(c,{title:"安装应用",icon:"down","is-link":"",onClick:i.navigateToPWAInstall},null,8,["onClick"])]),_:1}),n("div",null,[e(w,{modelValue:a.active,"onUpdate:modelValue":t[2]||(t[2]=m=>a.active=m)},{default:l(()=>[e(u,{name:"home",icon:"home-o",onClick:t[0]||(t[0]=m=>i.navigateTo("/merchant/home"))},{default:l(()=>t[3]||(t[3]=[_("主页")])),_:1}),e(u,{name:"order",icon:"description-o",onClick:t[1]||(t[1]=m=>i.navigateTo("/merchant/order"))},{default:l(()=>t[4]||(t[4]=[_("订单列表")])),_:1}),e(u,{name:"setting",icon:"setting-o"},{default:l(()=>t[5]||(t[5]=[_("设置")])),_:1})]),_:1},8,["modelValue"])])]),e(y)])}const Q=b(A,[["render",L],["__scopeId","data-v-1c725cc6"]]);export{Q as default};
